# where the template is
_subdirectory: template

# questions
project_name:
    type: str
    help: What is the project name?

pkg_name:
    type: str
    help: Top level Python package name
    default: "{{ project_name|lower|replace(' ', '_') }}"

version: 0.1.0

project_type:
  type: str
  help: What type of project is this?
  choices:
    - simple
    - django
    - fastapi

db_type:
  type: str
  help: what database is used in the project?
  choices:
    - none
    - sqlite
    - postgresql
    # - mysql
    # - mongodb

asyncio_db:
  type: bool
  help: Use asyncio database driver?
  choices:
    true:
      value: yes
      validator: "{% if project_type != 'fastapi' %} Only for FastAPI project {% endif %}"
    false:
      value: no

use_docker:
  type: bool
  default: false
  help: Generate Dockerfile and script for building container image?

use_devcontainer:
  type: bool
  default: false
  help: Generate devcontainer.json?

use_github_action:
  type: bool
  default: false
  help: Generate GitHub action for building, unit test and building container image?

_tasks:
    - git init .
    - git checkout -b develop
    - git add .gitignore .dockerignore .pre-commit-config.yaml .copier-answers.yml .vscode
    - >-
      {% if use_github_action %}
      git add .github
      {% else %}
      rm -rf .github
      {% endif %}
    - >-
      {% if use_devcontainer %}
      git add .devcontainer
      {% else %}
      rm -rf .devcontainer
      {% endif %}
    - >-
      {% if not use_docker %}
      rm Dockerfile entrypoint.sh
      {% endif %}
    - >-
      {% if project_type != "fastapi" %}
      rm database.py main.py
      {% endif %}
    - >-
      {% if project_type == "django" or db_type == "none" %}
      rm -rf migrations {{ pkg_name }}/models.py tests/test_models.py alembic.ini
      {% endif %}
    - git add *
    - git commit -m "generated by copier"
